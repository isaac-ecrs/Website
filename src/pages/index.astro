---
import { getCollection, getEntry } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';
import FeatureCard from '../components/FeatureCard.astro';
import EventHighlight from '../components/EventHighlight.astro';

import { marked } from 'marked';

// Import images
import heroBg from '../assets/images/hero-bg.jpg';
import iconActivities from '../assets/images/icons/activities.svg';
import iconEvents from '../assets/images/icons/events.svg';
import iconTestimonials from '../assets/images/icons/testimonials.svg';
import { Image } from 'astro:assets';
import imageWhatWeDo from '../assets/images/landing-page/what-we-do.jpg';
import imageWhatWeDoDance from '../assets/images/landing-page/what-we-do-dance.jpg';
import imageUpcomingEvents from '../assets/images/landing-page/upcoming-events.jpg';
import imageTestimonials from '../assets/images/landing-page/testemonials.jpg';
import imageWinterAdventure from '../assets/images/events/winter-adventure.jpg';

// Get content from collections
const homePage = await getEntry('pages', 'home');
const featuredEvent = (await getCollection('events')).find(e => e.data.featured);
---

<BaseLayout title="Home" description="ECRS - Come to Play. Play to Learn">

  <!-- SECTION 1: Hero -->
  <Hero
    title={homePage.data.hero.title}
    subtitle={homePage.data.hero.subtitle}
    backgroundImage={heroBg}
    ctaText={homePage.data.hero.ctaText}
    ctaLink={homePage.data.hero.ctaLink}
  />

  <!-- SECTION 2: Three Feature Cards -->
  <section class="section section--cream">
    <div class="container">
      <div class="grid-3">
        <FeatureCard
          image={imageWhatWeDo}
          title={homePage.data.featureCards[0].title}
          description={homePage.data.featureCards[0].description}
          link="/activities"
        />
        <FeatureCard
          image={imageUpcomingEvents}
          title={homePage.data.featureCards[1].title}
          description={homePage.data.featureCards[1].description}
          link="/events"
        />
        <FeatureCard
          image={imageTestimonials}
          title={homePage.data.featureCards[2].title}
          description={homePage.data.featureCards[2].description}
          link="/testimonials"
        />
      </div>
    </div>
  </section>

  <!-- SECTION 3: About ECRS Narrative (rendered from markdown) -->
  <section class="section section--white" id="about">
    <div class="container">
      <div class="about-content" set:html={marked(homePage.data.about)} />
    </div>
  </section>

  <!-- SECTION 4: What We Do -->
  <section class="section section--tan" id="programs">
    <div class="container">
      <h2 class="text-center">What We Do</h2>

      <div class="what-we-do-content">
        <div class="what-we-do-image">
          <Image src={imageWhatWeDoDance} alt="What We Do" />
        </div>
        <div class="what-we-do-text">
          <p class="section-intro">
            {homePage.data.whatWeDo.description}
          </p>

          <div class="activities-list" set:html={marked(homePage.data.whatWeDo.activities)} />
        </div>
      </div>
    </div>
  </section>

  <!-- SECTION 5: Event Highlight (Winter Adventure) -->
  {featuredEvent && (
    <EventHighlight
      title={featuredEvent.data.title}
      date={`${new Date(featuredEvent.data.startDate).toLocaleDateString('en-US', {year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit'})} – ${new Date(featuredEvent.data.endDate).toLocaleDateString('en-US', {year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit'})}`}
      description={featuredEvent.body}
      image={imageWinterAdventure}
      link={`/events/${featuredEvent.slug}`}
    />
  )}

  <!-- SECTION 6: Footer (included in BaseLayout) -->

</BaseLayout>

<style lang="scss">
@use '../styles/variables' as *;
@use '../styles/mixins' as *;

.about-content {
  max-width: 800px;
  margin: 0 auto;

  h2 {
    color: $color-primary;
    margin-bottom: 1.5em;
  }

  .about-text {
    p {
      font-size: 18px;
      line-height: 1.8;
      margin-bottom: 1.5em;

      &:last-child {
        margin-bottom: 0;
      }
    }
  }
}

.section-intro {
  max-width: 700px;
  margin: 0 auto 3em;
  font-size: 18px;
  color: rgba($color-text-dark, 0.7);
}

.what-we-do-content {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 3em;
  align-items: start;
  margin-top: 2em;

  @include mobile {
    grid-template-columns: 1fr;
    gap: 2em;
  }
}

.what-we-do-image {
  img {
    width: 100%;
    height: auto;
    border-radius: 3px;
    box-shadow: $shadow-image;
  }
}

.what-we-do-text {
  .section-intro {
    margin-bottom: 1.5em;
  }
}

.activities-list {
  :global(ul) {
    list-style: none;
    padding-left: 0;
  }

  :global(li) {
    font-size: 18px;
    line-height: 1.8;
    margin-bottom: 0.5em;
    color: $color-text-dark;
    padding-left: 1.5em;
    position: relative;
    list-style: none;

    &::before {
      content: '→';
      position: absolute;
      left: 0;
      color: $color-accent;
      font-weight: bold;
    }
  }
}
</style>
