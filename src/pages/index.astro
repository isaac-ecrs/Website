---
import { getCollection, getEntry } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';
import FeatureCard from '../components/FeatureCard.astro';
import ServiceCard from '../components/ServiceCard.astro';
import EventHighlight from '../components/EventHighlight.astro';
import CTASection from '../components/CTASection.astro';

// Import images
import heroBg from '../assets/images/hero-bg.jpg';
import iconActivities from '../assets/images/icons/activities.svg';
import iconEvents from '../assets/images/icons/events.svg';
import iconTestimonials from '../assets/images/icons/testimonials.svg';
import imageWhatWeDo from '../assets/images/landing-page/what-we-do.jpg';
import imageUpcomingEvents from '../assets/images/landing-page/upcoming-events.jpg';
import imageTestimonials from '../assets/images/landing-page/testemonials.jpg';
import imageSinging from '../assets/images/services/singing.jpg';
import imageDancing from '../assets/images/services/dancing.jpg';
import imageDramatics from '../assets/images/services/dramatics.jpg';
import imageGames from '../assets/images/services/games.jpg';
import imageCrafts from '../assets/images/services/crafts.jpg';
import imageDevelopment from '../assets/images/services/development.jpg';
import imageWinterAdventure from '../assets/images/events/winter-adventure.jpg';

// Get content from collections
const homePage = await getEntry('pages', 'home');
const { Content } = await homePage.render();
const featuredEvent = (await getCollection('events')).find(e => e.data.featured);

// Service images array
const serviceImages = [
  imageSinging,
  imageDancing,
  imageDramatics,
  imageGames,
  imageCrafts,
  imageDevelopment,
];
---

<BaseLayout title="Home" description="ECRS - Come to Play. Play to Learn">

  <!-- SECTION 1: Hero -->
  <Hero
    title={homePage.data.hero.title}
    subtitle={homePage.data.hero.subtitle}
    backgroundImage={heroBg}
    ctaText={homePage.data.hero.ctaText}
    ctaLink={homePage.data.hero.ctaLink}
  />

  <!-- SECTION 2: Three Feature Cards -->
  <section class="section section--cream">
    <div class="container">
      <div class="grid-3">
        <FeatureCard
          image={imageWhatWeDo}
          title={homePage.data.featureCards[0].title}
          description={homePage.data.featureCards[0].description}
          link="/activities"
        />
        <FeatureCard
          image={imageUpcomingEvents}
          title={homePage.data.featureCards[1].title}
          description={homePage.data.featureCards[1].description}
          link="/events"
        />
        <FeatureCard
          image={imageTestimonials}
          title={homePage.data.featureCards[2].title}
          description={homePage.data.featureCards[2].description}
          link="/testimonials"
        />
      </div>
    </div>
  </section>

  <!-- SECTION 3: About ECRS Narrative (rendered from markdown) -->
  <section class="section section--white" id="about">
    <div class="container">
      <div class="about-content">
        <Content />
      </div>
    </div>
  </section>

  <!-- SECTION 4: Service Offerings -->
  <section class="section section--tan" id="programs">
    <div class="container">
      <h2 class="text-center">Lorem Ipsum Programs</h2>
      <p class="text-center section-intro">
        Lorem ipsum dolor sit amet consectetur adipiscing elit sed do eiusmod tempor incididunt.
      </p>

      <div class="services-grid">
        <ServiceCard
          title="Lorem Ipsum One"
          description="Lorem ipsum dolor sit amet, consectetur adipiscing elit sed do eiusmod tempor incididunt ut labore et dolore magna aliqua."
          image={imageSinging}
        />
        <ServiceCard
          title="Lorem Ipsum Two"
          description="Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat."
          image={imageDancing}
        />
        <ServiceCard
          title="Lorem Ipsum Three"
          description="Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur."
          image={imageDramatics}
        />
        <ServiceCard
          title="Lorem Ipsum Four"
          description="Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est."
          image={imageGames}
        />
        <ServiceCard
          title="Lorem Ipsum Five"
          description="Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium."
          image={imageCrafts}
        />
        <ServiceCard
          title="Lorem Ipsum Six"
          description="Totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta."
          image={imageDevelopment}
        />
      </div>

      <p class="text-center" style="margin-top: 2em; color: rgba(69, 67, 64, 0.8);">
        The programs listed above are detailed in the markdown content and can be managed via Decap CMS.
      </p>
    </div>
  </section>

  <!-- SECTION 5: Event Highlight (Winter Adventure) -->
  {featuredEvent && (
    <EventHighlight
      title={featuredEvent.data.title}
      date={`${new Date(featuredEvent.data.startDate).toLocaleDateString('en-US', {year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit'})} â€“ ${new Date(featuredEvent.data.endDate).toLocaleDateString('en-US', {year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit'})}`}
      description={featuredEvent.body}
      image={imageWinterAdventure}
      link={`/events/${featuredEvent.slug}`}
    />
  )}

  <!-- SECTION 6: Call-to-Action Donation -->
  <CTASection
    title={homePage.data.donationCta.title}
    description={homePage.data.donationCta.description}
    buttonText={homePage.data.donationCta.buttonText}
    buttonLink={homePage.data.donationCta.buttonLink}
    backgroundColor="#378e3c"
  />

  <!-- SECTION 7: Footer (included in BaseLayout) -->

</BaseLayout>

<style lang="scss">
@use '../styles/variables' as *;

.about-content {
  max-width: 800px;
  margin: 0 auto;

  h2 {
    color: $color-primary;
    margin-bottom: 1.5em;
  }

  .about-text {
    p {
      font-size: 18px;
      line-height: 1.8;
      margin-bottom: 1.5em;

      &:last-child {
        margin-bottom: 0;
      }
    }
  }
}

.section-intro {
  max-width: 700px;
  margin: 0 auto 3em;
  font-size: 18px;
  color: rgba($color-text-dark, 0.7);
}

.services-grid {
  margin-top: 2em;
}
</style>
