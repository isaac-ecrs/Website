---
/**
 * Base Card Component
 *
 * WHY THIS PATTERN (Pseudo-element Overlay Technique):
 * Cards need to be fully clickable while allowing internal links (venue website,
 * map directions) to remain separately clickable. We solve this by:
 *
 * 1. The main link's ::after pseudo-element covers the entire card (z-index: 1)
 * 2. Internal links get z-index: 2 to sit above the overlay
 * 3. Focus states are handled by the parent card element, not the link
 *
 * This approach beats wrapping everything in <a> because:
 * - Screen readers announce it as a single link (not every element)
 * - Internal links remain independently clickable and focusable
 * - Hover/focus states apply to the whole card visually
 *
 * SLOTS:
 * - media: Optional image/video content (left side in horizontal, top in vertical)
 * - content: Main card content (title, description, metadata)
 * - cta: Call-to-action text that becomes the clickable link
 */
interface Props {
  href: string; // Required - cards are always clickable
  variant?: 'vertical' | 'horizontal'; // Layout direction (default: vertical)
  isPast?: boolean; // For dimmed styling (events only)
  hasMedia?: boolean; // Whether the card has media (for horizontal layout)
  class?: string; // Additional classes
  'data-reveal'?: string; // Animation direction for scroll reveal
}

const {
  href,
  variant = 'vertical',
  isPast = false,
  hasMedia = false,
  class: additionalClass = '',
  'data-reveal': dataReveal,
} = Astro.props;
---

<article
  class={`card card--${variant} ${isPast ? 'card--past' : ''} ${hasMedia ? 'card--has-media' : 'card--no-media'} ${additionalClass}`}
  data-reveal={dataReveal}
>
  <slot name="media" />
  <slot name="content" />
  <a href={href} class="card-main-link">
    <slot name="cta" />
  </a>
</article>

<style lang="scss">
  @use '../styles/variables' as *;
  @use '../styles/mixins' as *;

  .card {
    position: relative;
    display: block;
    background: white;
    padding: 2em;
    border-radius: $border-radius-card;
    box-shadow: 10px 10px 0px rgba($color-text-dark, 0.08);
    transition:
      transform $transition-fast,
      box-shadow $transition-fast;
    color: inherit;

    &:hover {
      transform: translateY(-5px);
      box-shadow: 10px 10px 0px rgba($color-text-dark, 0.12);
    }

    &:has(.card-main-link:focus-visible) {
      outline: 2px solid $color-accent;
      outline-offset: 4px;
    }

    &.card--past {
      opacity: 0.7;
      filter: brightness(90%);
    }

    // Layout variants
    &.card--vertical {
      display: flex;
      flex-direction: column;
    }

    &.card--horizontal {
      display: grid;
      grid-template-columns: 1fr;
      gap: 2em;
      align-items: start;

      @include mobile {
        grid-template-columns: 1fr;
        gap: 1.5em;
      }

      &.card--has-media {
        grid-template-columns: 200px 1fr;

        @include mobile {
          grid-template-columns: 1fr;
        }
      }

      &.card--no-media {
        grid-template-columns: 1fr;
      }

      // Hide empty media slots
      :global([slot='media']:empty) {
        display: none;
      }
    }

    // Internal links (venue website, directions, etc.) need higher z-index
    :global(a:not(.card-main-link)) {
      position: relative;
      z-index: 2;
    }
  }

  // Main card link - covers entire card with pseudo-element
  .card-main-link {
    display: inline-block;
    text-decoration: none;
    cursor: pointer;

    // Pseudo-element covers entire card for click area
    &::after {
      content: '';
      position: absolute;
      inset: 0;
      z-index: 1;
    }

    &:focus-visible {
      outline: none; // Outline handled by parent .card
    }
  }

  // Shared CTA link styling (works for slotted content)
  :global(.card-link) {
    display: inline-block;
    color: $color-accent;
    font-weight: 600;
    text-decoration: none;
    transition: color $transition-fast;
  }

  .card:hover :global(.card-link),
  .card:has(.card-main-link:focus-visible) :global(.card-link) {
    color: $color-teal;
  }
</style>
