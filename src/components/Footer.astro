---
import { getEntry } from 'astro:content';

const siteSettings = await getEntry('settings', 'site');
const { organizationName, tagline, footer } = siteSettings?.data || {
  organizationName: 'ECRS',
  tagline: '',
  footer: {
    aboutText: '',
    copyrightText: 'All rights reserved.',
    columns: [],
    contactText: '',
    contactLink: '/contact',
  },
};
---

<footer class="site-footer">
  <div class="container">
    <div class="footer-columns">
      <div class="footer-column">
        <h4>About ECRS</h4>
        <p>{footer.aboutText}</p>
      </div>

      {
        footer.columns.map((column) => (
          <div class="footer-column">
            <h4>{column.title}</h4>
            <ul>
              {column.links.map((link) => (
                <li>
                  <a href={link.href}>{link.label}</a>
                </li>
              ))}
            </ul>
          </div>
        ))
      }

      <div class="footer-column">
        <h4>Contact</h4>
        <p>
          {
            /* Safely handle contact text - if pattern not found, show full text with link */
          }
          {
            footer.contactText.includes('regional contacts') ? (
              <>
                {footer.contactText.split('regional contacts')[0]}
                <a href={footer.contactLink}>regional contacts</a>
                {footer.contactText.split('regional contacts')[1] || '.'}
              </>
            ) : (
              <>
                {footer.contactText} <a href={footer.contactLink}>Contact us</a>
                .
              </>
            )
          }
        </p>
        {tagline && <p class="tagline">{tagline}</p>}
      </div>
    </div>

    <div class="footer-bottom">
      <p>
        &copy; {new Date().getFullYear()}
        {organizationName}. {footer.copyrightText}
      </p>
    </div>
  </div>
</footer>

<style lang="scss">
  @use '../styles/variables' as *;
  @use '../styles/mixins' as *;

  .site-footer {
    background-color: $color-dark-brown;
    color: white;
    padding: 3em 0 1.5em;

    .footer-columns {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 2em;
      margin-bottom: 2em;

      @include mobile {
        grid-template-columns: 1fr;
        gap: 1.5em;
      }
    }

    .footer-column {
      h4 {
        color: $color-accent;
        font-size: 18px;
        margin-bottom: 1em;
        font-family: $font-heading;
        font-weight: $font-weight-bold;
        text-transform: uppercase;
      }

      ul {
        list-style: none;

        li {
          margin-bottom: 0.5em;
        }
      }

      a {
        color: white;
        text-decoration: none;
        transition: color $transition-fast;

        &:hover {
          color: $color-accent;
        }
      }

      p {
        font-size: 14px;
        line-height: 1.6;
      }

      .tagline {
        font-style: italic;
        margin-top: 1em;
        color: $color-accent;
      }
    }

    .footer-bottom {
      border-top: 1px solid rgba(white, 0.1);
      padding-top: 1em;
      text-align: center;

      p {
        font-size: 13px;
        opacity: 0.8;
      }
    }
  }
</style>
